(function(c){var a={VERSION:"2.2.0",JAVASCRIPT_STATE_MACHINE_PROPERTY_NAME:"Javascript State Machine",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(j,k){var m=(typeof j.initial=="string")?{state:j.initial}:j.initial;var i=k||j.target||{};var h=!!(k||j.target);var p=j.events||[];var l=j.callbacks||{};var f={};var o=function(q){var s=(q.from instanceof Array)?q.from:(q.from?[q.from]:[a.WILDCARD]);f[q.name]=f[q.name]||{};for(var r=0;r<s.length;r++){f[q.name][s[r]]=q.to||s[r]}};if(m){m.event=m.event||"startup";o({name:m.event,from:"none",to:m.state})}for(var g=0;g<p.length;g++){o(p[g])}for(var e in f){if(f.hasOwnProperty(e)){i[e]=a.buildEvent(e,f[e],h?undefined:i)}}for(var e in l){if(l.hasOwnProperty(e)){i[e]=l[e]}}i.current="none";i.is=function(n){return this.current==n};i.can=function(n){return !this.transition&&(f[n].hasOwnProperty(this.current)||f[n].hasOwnProperty(a.WILDCARD))};i.cannot=function(n){return !this.can(n)};i.error=j.error||function(r,v,u,q,n,t,s){throw s||t};b(i);if(m&&!m.defer){i[m.event]()}return i},doCallback:function(j,h,g,l,k,f){if(h){try{return h.apply(j,[g,l,k].concat(f))}catch(i){return j.error(g,l,k,f,a.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",i)}}},beforeEvent:function(g,f,i,h,e){return a.doCallback(g,g["onbefore"+f],f,i,h,e)},afterEvent:function(g,f,i,h,e){return a.doCallback(g,g["onafter"+f]||g["on"+f],f,i,h,e)},leaveState:function(g,f,i,h,e){return a.doCallback(g,g["onleave"+i],f,i,h,e)},enterState:function(g,f,i,h,e){return a.doCallback(g,g["onenter"+h]||g["on"+h],f,i,h,e)},changeState:function(g,f,i,h,e){return a.doCallback(g,g.onchangestate,f,i,h,e)},buildEvent:function(e,g,f){return function(){var j=d(this)?this:f;if(j===undefined){throw": Event called with invalid `this` - try wrapping call in function: setTimeout(function () { sm.event(); }, 1000);"}var l=j.current;var k=g[l]||g[a.WILDCARD]||l;var i=Array.prototype.slice.call(arguments);if(j.transition){return j.error(e,l,k,i,a.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete")}if(j.cannot(e)){return j.error(e,l,k,i,a.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current)}if(false===a.beforeEvent(j,e,l,k,i)){return a.CANCELLED}if(l===k){a.afterEvent(j,e,l,k,i);return a.NOTRANSITION}j.transition=function(){j.transition=null;j.current=k;a.enterState(j,e,l,k,i);a.changeState(j,e,l,k,i);a.afterEvent(j,e,l,k,i)};j.transition.cancel=function(){j.transition=null;a.afterEvent(j,e,l,k,i)};var h=a.leaveState(j,e,l,k,i);if(false===h){j.transition=null;return a.CANCELLED}else{if("async"===h){return a.ASYNC}else{if(j.transition){j.transition()}return a.SUCCEEDED}}}}};var d=function(e){return e&&e[a.JAVASCRIPT_STATE_MACHINE_PROPERTY_NAME]===a.VERSION};var b=function(e){e[a.JAVASCRIPT_STATE_MACHINE_PROPERTY_NAME]=a.VERSION};if("function"===typeof define){define(function(e){return a})}else{c.StateMachine=a}}(this));